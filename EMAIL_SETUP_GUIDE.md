# Email Setup Guide

This guide will help you configure Gmail to send weekly prayer schedules automatically through GitHub Actions.

## Prerequisites

- Access to the Gmail account: **churchprayerlistelders@gmail.com**
- Admin access to the GitHub repository
- Two-factor authentication enabled on the Gmail account (required for App Passwords)

## Step 1: Create Gmail App Password

Google requires App Passwords (not your regular password) for applications to access Gmail via SMTP.

### 1.1 Enable 2-Factor Authentication (if not already enabled)

1. Go to your Google Account: https://myaccount.google.com/
2. Navigate to **Security** → **2-Step Verification**
3. Follow the prompts to enable 2FA

### 1.2 Generate App Password

1. Go to your Google Account: https://myaccount.google.com/
2. Navigate to **Security** → **2-Step Verification**
3. Scroll down to **App passwords** and click it
4. Select app: **Mail**
5. Select device: **Other (Custom name)**
6. Enter name: **Prayer Schedule Automation**
7. Click **Generate**
8. Google will show a 16-character password (e.g., `abcd efgh ijkl mnop`)
9. **IMPORTANT:** Copy this password immediately - you won't be able to see it again!

**Example App Password format:**
```
abcd efgh ijkl mnop
```
(Remove spaces when entering into GitHub Secrets)

## Step 2: Configure GitHub Secrets

GitHub Secrets store sensitive information securely and make it available to workflows.

### 2.1 Access Repository Secrets

1. Go to your GitHub repository
2. Click **Settings** tab
3. In the left sidebar, click **Secrets and variables** → **Actions**
4. Click **New repository secret**

### 2.2 Add Required Secrets

Create these **three** secrets:

#### Secret 1: SENDER_EMAIL
- **Name:** `SENDER_EMAIL`
- **Value:** `churchprayerlistelders@gmail.com`
- Click **Add secret**

#### Secret 2: SENDER_PASSWORD
- **Name:** `SENDER_PASSWORD`
- **Value:** The 16-character App Password from Step 1.2 (without spaces)
  - Example: `abcdefghijklmnop`
- Click **Add secret**

#### Secret 3: RECIPIENT_EMAILS
- **Name:** `RECIPIENT_EMAILS`
- **Value:** Comma-separated list of all recipient emails (see full list below)
- Click **Add secret**

**Current Recipients (10 total):**
```
elders@crossvillechurchofchrist.org,carolsparks.cs@gmail.com,frankbo72@gmail.com,kfair232@gmail.com,laccafox@gmail.com,alanhjudd@gmail.com,lovedayj@frontiernet.net,larrymcduffee@gmail.com,brianmclaughlin423@gmail.com,jbw@benlomand.net
```

| Recipient | Email | Role |
|-----------|-------|------|
| Elder Group List | elders@crossvillechurchofchrist.org | Group distribution list |
| Carol Sparks | carolsparks.cs@gmail.com | Church staff |
| Frank Bohannon | frankbo72@gmail.com | Elder |
| Kyle Fairman | kfair232@gmail.com | Elder |
| L.A. Fox | laccafox@gmail.com | Elder |
| Alan Judd | alanhjudd@gmail.com | Elder |
| Jonathan Loveday | lovedayj@frontiernet.net | Elder |
| Larry McDuffee | larrymcduffee@gmail.com | Elder |
| Brian McLaughlin | brianmclaughlin423@gmail.com | Elder |
| Jerry Wood | jbw@benlomand.net | Elder |

### 2.3 Verify Secrets

After adding all three secrets, you should see:
- ✅ SENDER_EMAIL
- ✅ SENDER_PASSWORD
- ✅ RECIPIENT_EMAILS

## Step 3: Test the Email Functionality

### Option A: Manual Workflow Run (Recommended)

1. Go to **Actions** tab in GitHub
2. Select **Weekly Prayer Schedule Generation** workflow
3. Click **Run workflow** button
4. Select the branch (usually main)
5. Click **Run workflow**
6. Wait for the workflow to complete (~1-2 minutes)
7. Check the logs for email confirmation
8. Verify recipients received the email

### Option B: Local Testing (Optional)

If you want to test locally before pushing:

```bash
# Set environment variables (Linux/Mac)
export EMAIL_ENABLED=true
export SENDER_EMAIL="churchprayerlistelders@gmail.com"
export SENDER_PASSWORD="your-app-password-here"
export RECIPIENT_EMAILS="elders@crossvillechurchofchrist.org,carolsparks.cs@gmail.com,frankbo72@gmail.com,kfair232@gmail.com,laccafox@gmail.com,alanhjudd@gmail.com,lovedayj@frontiernet.net,larrymcduffee@gmail.com,brianmclaughlin423@gmail.com,jbw@benlomand.net"

# Run the script
python prayer_schedule_V10_DESKTOP_FIXED.py
```

For Windows:
```cmd
set EMAIL_ENABLED=true
set SENDER_EMAIL=churchprayerlistelders@gmail.com
set SENDER_PASSWORD=your-app-password-here
set RECIPIENT_EMAILS=elders@crossvillechurchofchrist.org,carolsparks.cs@gmail.com,frankbo72@gmail.com,kfair232@gmail.com,laccafox@gmail.com,alanhjudd@gmail.com,lovedayj@frontiernet.net,larrymcduffee@gmail.com,brianmclaughlin423@gmail.com,jbw@benlomand.net

python prayer_schedule_V10_DESKTOP_FIXED.py
```

## Step 4: Verify Email Delivery

### Expected Email Format

**Subject:** `Weekly Prayer Schedule - Week 46 (Nov 10-16, 2025)`

**Body:**
```
Greetings,

Please find below the prayer schedule for Week 46 (Nov 10-16, 2025).

[Full text schedule content here]

This schedule was automatically generated by the Prayer Schedule System.

Blessings,
Crossville Church of Christ Elder Ministry
```

### Check Workflow Logs

1. Go to **Actions** tab
2. Click on the workflow run
3. Click on the **generate-schedule** job
4. Expand **Run prayer schedule generator** step
5. Look for email-related messages:
   - `[EMAIL] Connecting to smtp.gmail.com:587...`
   - `[EMAIL] Logging in as churchprayerlistelders@gmail.com...`
   - `[EMAIL] Sending to: elders@crossvillechurchofchrist.org, carolsparks.cs@gmail.com, frankbo72@gmail.com, ...`
   - `[✓] Email sent successfully to 10 recipient(s)`

## Troubleshooting

### Error: "Email authentication failed"

**Cause:** Incorrect App Password or 2FA not enabled

**Solution:**
1. Verify 2-Factor Authentication is enabled on the Gmail account
2. Generate a new App Password
3. Update the `SENDER_PASSWORD` secret in GitHub
4. Make sure you copied the App Password correctly (no spaces)

### Error: "Email is disabled"

**Cause:** EMAIL_ENABLED environment variable not set

**Solution:**
- Verify the workflow file includes `EMAIL_ENABLED: 'true'` in the env section
- Check that the workflow file was committed and pushed

### Error: "No recipient emails configured"

**Cause:** RECIPIENT_EMAILS secret is empty or not set

**Solution:**
- Verify the RECIPIENT_EMAILS secret exists in GitHub Settings
- Ensure the value contains all 10 recipient emails (see Secret 3 above for full list)

### Email not received

**Check these common issues:**

1. **Spam folder:** Check recipient spam/junk folders
2. **Gmail filters:** Check if Gmail has filtered the email
3. **Email address typos:** Verify recipient email addresses are correct
4. **Workflow logs:** Check GitHub Actions logs for error messages
5. **Gmail account status:** Ensure the sender account is active and not suspended

### Testing Email Addresses

To test without sending to the actual recipients, temporarily change `RECIPIENT_EMAILS` to:
```
your-test-email@gmail.com
```

Remember to change it back after testing!

## Security Best Practices

✅ **DO:**
- Use App Passwords (never use your actual Gmail password)
- Store credentials in GitHub Secrets (never in code)
- Enable 2-Factor Authentication on the Gmail account
- Regularly rotate App Passwords (every 6-12 months)
- Monitor workflow logs for suspicious activity

❌ **DON'T:**
- Commit passwords to git
- Share App Passwords publicly
- Reuse App Passwords across multiple applications
- Disable 2-Factor Authentication

## Updating Recipients

To add or remove email recipients:

1. Go to **Settings** → **Secrets and variables** → **Actions**
2. Click on **RECIPIENT_EMAILS**
3. Click **Update secret**
4. Modify the comma-separated list:
   ```
   email1@example.com,email2@example.com,email3@example.com
   ```
5. Click **Update secret**

## Disabling Email Temporarily

To temporarily disable email sending without removing secrets:

1. Edit `.github/workflows/weekly-schedule.yml`
2. Change `EMAIL_ENABLED: 'true'` to `EMAIL_ENABLED: 'false'`
3. Commit and push the change

To re-enable, change it back to `'true'`.

## Support

If you encounter issues:

1. Check the workflow logs in GitHub Actions
2. Verify all three secrets are configured correctly
3. Test the App Password using a desktop email client first
4. Review this guide for troubleshooting steps
5. Contact the repository maintainer if issues persist

---

**Last Updated:** February 2026
**System:** Prayer Schedule Automation v10
